<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<meta charset="UTF-8">
<body>
<div layout:fragment="content">
    <h3>All Requested Auth</h3>
    <div th:if="${!auth.isEmpty()}">
        <table class="table table-borderless">
            <thead align="center">
            <tr>
                <th scope="col">이름</th>
                <th scope="col">이메일</th>
                <th scope="col">요청 권한</th>
                <th scope="col">요청일</th>
            </tr>
            </thead>
            <tbody align="center" id="tbody">
            <tr th:each="auth1:${auth}" id="tbody_tr">
                <!--<div th:href="@{/auth/get?number={number}(number=${auth1.authId})}">-->
                <td id="t_name"><a th:text="${auth1.name}"></a></td>
                <td id="t_email"><a th:text="${auth1.email}"></a></td>
                <td id="t_roles"><a th:text="${auth1.roles}"></a></td>
                <td id="t_created"><a th:text="${auth1.createdAt}"></a></td>
                <!--</div>-->
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${!auth.last}">
        <button type="button" th:attr="data-page=${auth.number+1}" id="showBtn">더보기</button>
    </div>

    <script th:inline="javascript">
        $(function() {
            $('#showBtn').on("click",function() {
                showMore();
            });
        });

        function showMore() {
        /*
            var showButton = document.getElementById("showBtn");
            var page = showButton.getAttribute("data-page");
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if(xhr.status == 200 && xhr.readyState == 4) {
                    var response = xhr.responseText;
                    var tbody = document.querySelector("table tbody");
                    tbody.innerHTML += response;
                    var nextPage = Number(page)+1;
                    showButton.setAttribute("data-page", nextPage);
                }

            };
            xhr.open("GET", "/requested?page="+(Number(page) + 1), true);
            xhr.send();
            */

            /*
            var showBtn = document.getElementById("showBtn");
            var page = parseInt($('#showBtn').attr('data-page'))+1;
            $.ajax({
                type: 'GET',
                url: '/auth/requested?page='+page,
                success: function(data, xhr) {
                    console.log(data);
                    console.log(xhr.responseText);
                    var tbody = document.querySelector("table tbody");
                    tbody.append(data);
                    $('#showMore').attr('data-page', page);
                },
            });*/

            var showBtn = $('#showBtn');
            var page = showBtn.data("page");
            page = Number(page)+1;
            showBtn.data('page', page);
            $.ajax({
                url: "/auth/requestedAuth",
                type: "GET",
                data: {"page":page},
                success: function(response) {
                    var requestedList = response.content;
                    var isLast = response.last;
                    var tbody = $('#tbody');
                    for (var i=0; i<requestedList.length; i++) {
                        var requested = requestedList[i];
                        var tname = $("<td>").text(requested.name);
                        var temail = $('<td>').text(requested.email);
                        var troles = $('<td>').text(requested.roles);
                        var tcreated = $('<td>').text(requested.createdAt);
                        tbody.append("<tr>").append(tname).append("</td>").append(temail).append("</td>").append(troles).append("</td>").append(tcreated).append("</td>").append("</tr>");
                    }
                    if (isLast) {
                        showBtn.css('display', 'none');
                    }

                }
            });

        }
    </script>
</div>
</body>
</html>