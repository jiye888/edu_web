<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<meta charset="UTF-8">

    <div layout:fragment="content">

        <form> <!--role="form" method="post" action="/member/loginCheck">-->
            <div>
                <label th:for="email">이메일 주소</label>
                <input type="email" class="form-control" id="email" name="email" class="form-control">
            </div>
            <div>
                <label th:for="password">비밀번호</label>
                <input type="password" class="form-control" name="password" id="password" class="form-control">
            </div>
            <p th:if="${msg}" class="error" th:text="${msg}"></p>
            <button type="button" class="btn btn-primary" id="loginBtn">로그인</button>
            <button type="button" class="btn btn-primary" onclick="location.href='/member/join';">회원 가입</button>
            <!--<input type="hidden" th:id="${token}" th:value="${token}">-->
        </form>
        <script th:inline="javascript">

        $(function() {
            $('#loginBtn').on('click', function() {
                login();
            });
        });

        function login() {
            var email = $('#email').val();
            var password = $('#password').val();

            if (validate(email, password) == true){
                const path = '/member/loginCheck';
                const json = {
                    "email": email,
                    "password": password,
                };
                $.ajax({
                    url: path,
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(json),
                    beforeSend: function(xhr) {
                    },
                    success: function(response) {
                        var token = response;
                        if (token != null) {
                            localStorage.setItem("jwt", token);
                            history.back();
                        }
                    },
                    error: function(response) {
                        jwtFilter();
                        alert("아이디나 비밀번호를 다시 확인해주세요.");
                        console.log(response);
                    },
                });
            }
        }

        function validate(email, password){
            if (!email) {
                alert('아이디를 입력해주세요');
                return false;
            }
            if (!password ) {
                alert('패스워드를 입력해주세요');
                return false;
            }
            return true;
        }

    </script>
    </div>

</html>