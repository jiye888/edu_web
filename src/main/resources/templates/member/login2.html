<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<meta charset="UTF-8">
<body>
<div layout:fragment="content">
        <div>
            <label th:for="email">이메일 주소</label>
            <input type="email" name="email" id="email" class="form-control">
        </div>
        <div>
            <label th:for="password">비밀번호</label>
            <input type="password" name="password" id="password" class="form-control">
        </div>
        <p th:if="${msg}" class="error" th:text="${msg}"></p>
        <button class="btn btn-primary" id="login">로그인</button>
        <button type="button" class="btn btn-primary" onclick="location.href='/member/join';">회원 가입</button>

</div>

<script th:inline="javascript">
        fetch("/member/loginCheck", {
        method: 'post',
        headers: {
            'content-type':'application/json'
        },
        body: JSON.stringify({
            email: $email.value,
            password: $password.value
        })
    }).then(res => res.json())
        .then(token => {
            localStorage.setItem("jwt", token)
            alert("로그인에 성공했습니다.");
        });

    var httpRequest = new XMLHttpRequest();
    httpRequest.onreadystatechange = function() {
        if(httpRequest.readyState == XMLHttpRequest.DONE && httpRequest.status == 200) {
            document.getElementById("email").innerHTML = httpRequest.responseText;
        }
    };
    httpRequest.open("GET", "URL", true);
    httpRequest.setRequestHeader("");
    httpRequest.send();

    fetch('http://localhost:8000/login/', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        'id': 'kim',
        'password': '1234'
      })
    })
    .then(response => response.json())
    .then(response => {
      if (response.token) {
        localStorage.setItem('wtw-token', response.token);
      }
    })
    let token = localStorage.getItem('wtw-token') || '';
    fetch('http://localhost:8000/likes/', {
      headers: {
          'Authorization': token,
      }
    })
    .then(response => response.json())
    .then(response => {
       console.log(response.data);
    })


        function order() {
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");
            var url = '/cart/orders';
            var dataList = new Array();
            var paramData = new Object();
            $("input[name=cartChkBox]:checked").each(function() {
                var cartItemId = $(this).val();
                var data = new Object();
                data["cartItemId"] = cartItemId;
                dataList.push(data);
            });
            paramData['cartOrderDtoList'] = dataList;
            var param = JSON.stringify(paramData);
            $.ajax({
                url : url,
                type : "POST",
                contentType : 'application/json',
                data : param,
                beforeSend : function(xhr) {
                    xhr.setRequestHeader(header, token);
                },
                dataType : "json",
                cache : false,
                success : function(result, status) {
                    alert("주문이 완료되었습니다.");
                    location.href='/orders';
                },
                error : function(jqXHR, status, error) {
                    if(jqXHR.status == '401'){
                        alert('로그인 후 이용해주세요');
                        location.href='/members/login';
                    } else {
                        alert(jqXHR.responseJSON.message);
                    }
                }
            });
        }
*/
</script>
</body>
</html>